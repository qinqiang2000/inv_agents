---
name: invoice-field-recommender
description: Recommend UBL invoice field values based on historical invoice data and basic master data. Use this skill when the user requests field value recommendations for invoice generation, providing tenant ID, target field name, and UBL 2.1 format pending invoice data. The skill automatically extracts country from supplier address and searches similar invoices first, then falls back to basic master data or WebSearch if needed.
---

# Invoice Field Recommender

## Overview

Provide intelligent field value recommendations for UBL 2.1 invoice generation by analyzing historical successfully-issued invoices and basic master data in the `/context` directory.

## When to Use This Skill

Use this skill when the user provides:
- **Tenant ID** (e.g., `1`, `10`, `89`)
- **Country code** (e.g., `DE`, `FR`, `MY`)
- **Target Field Name** to recommend (e.g., `unitCode`, `TaxCategory`, `PaymentMeans`)
- **Invoice File Path** - Path to the pending invoice file in `./context/pending-invoices/{tenantId}/`

## Input Format

### Required Parameters

| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `tenantId` | String | Tenant identifier (numeric) | `"1"`, `"10"`, `"89"` |
| `targetField` | String | UBL field name to recommend | `"unitCode"`, `"TaxCategory"`, `"PaymentMeans"` |
| `invoiceFilePath` | String | Path to pending invoice file | `"./context/pending-invoices/1/order-2024-001.xml"` |

## Input Validation

**CRITICAL: Before starting the recommendation workflow, validate all required inputs.**

### Validation Process

```
VALIDATION PHASE (Execute BEFORE any processing):
1. Check tenantId:
   - MUST be present and non-empty
   - MUST be numeric string
   - If missing â†’ Return TENANT_ID_REQUIRED error

2. Check targetField:
   - MUST be present and non-empty
   - MUST be a recognized UBL field name
   - If missing â†’ Return INVALID_TARGET_FIELD error

3. Check invoiceFilePath:
   - MUST be present and non-empty
   - MUST start with `./context/pending-invoices/{tenantId}/`
   - File MUST exist
   - If missing â†’ Return INVOICE_FILE_REQUIRED error
   - If file not found â†’ Return INVOICE_FILE_NOT_FOUND error
```

### Error Response Format

```json
{
  "error": "ERROR_CODE",
  "message": "English error message",
  "missing_parameters": ["parameter1", "parameter2"]
}
```

## Security Guardrails

**CRITICAL: These security rules MUST be enforced at all times.**

### Tenant Isolation Rules

1. **Tenant ID is MANDATORY**
   - Every request MUST include a valid tenantId
   - DO NOT proceed without tenantId

2. **Pending Invoice Access Restriction**
   - ONLY read pending invoices from `./context/pending-invoices/{tenantId}/`
   - invoiceFilePath MUST match the provided tenantId
   - REJECT any path containing `..` (path traversal)

3. **Historical Invoice Search Restriction**
   - ONLY search in `./context/invoices/{tenantId}/{countryCode}/`
   - NEVER access other tenant directories
   - REJECT any path containing `..` (path traversal)

4. **Path Validation**
   ```python
   # Before reading pending invoice file:
   expected_pending_prefix = f"./context/pending-invoices/{tenant_id}/"
   if not invoice_file_path.startswith(expected_pending_prefix):
       raise SecurityError("ACCESS_DENIED: Cross-tenant pending invoice access blocked")
   
   # Before reading historical invoice file:
   expected_history_prefix = f"./context/invoices/{tenant_id}/"
   if not file_path.startswith(expected_history_prefix):
       raise SecurityError("ACCESS_DENIED: Cross-tenant access blocked")
   
   if ".." in file_path:
       raise SecurityError("PATH_TRAVERSAL_DETECTED")
   ```

5. **Basic Data Access**
   - `./context/basic-data/` is shared and accessible to all tenants
   - No tenant restriction on basic-data directory

## Field Dependency Extraction

Based on the target field, extract relevant dependency data from invoiceData. åº•ä¸‹ä»…ä¾›å‚è€ƒã€‚

| Target Field | Dependency Path(s) | Context for Matching |
|--------------|-------------------|---------------------|
| `unitCode` | `InvoiceLine[].Item.Name`, `InvoiceLine[].Item.Description` | Product type determines unit |
| `TaxCategory.ID` | `InvoiceLine[].Item.Name`, `InvoiceLine[].Item.Description` | Tax treatment by product type |
| `TaxCategory.Percent` | `TaxCategory.ID` | Rate lookup by category |
| `PaymentMeansCode` | `AccountingCustomerParty`, `InvoiceTypeCode`, `LegalMonetaryTotal.PayableAmount` | Transaction context |
| `DocumentCurrencyCode` | `AccountingSupplierParty.Party.PostalAddress.Country` | Default currency by country |
| `InvoiceTypeCode` | Full invoice context | Transaction nature |
| `AllowanceChargeReason` | `InvoiceLine[].AllowanceCharge[].ChargeIndicator` | Charge/Allowance indicator |
| `TaxExemptionReason` | `TaxCategory.ID` | If category is E/Z |
| `CountrySubentity` | `PostalAddress.CityName` | State/province lookup |
| `PostalZone` | `PostalAddress.StreetName`, `CityName` | ZIP/postal code lookup |

## Recommendation Workflow

**æ ¸å¿ƒåŸåˆ™**: æ‰€æœ‰æ¨èå¿…é¡»åŸºäº**è¯­ä¹‰ç›¸ä¼¼æ€§**ï¼Œè€Œéç®€å•çš„å­—ç¬¦ä¸²ç›¸ç­‰åŒ¹é…

**æ¸è¿›å¼æŸ¥æ‰¾**: å†å²æ•°æ® â†’ Country-specific â†’ Global â†’ WebSearch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INPUT VALIDATION                          â”‚
â”‚  - Validate tenantId, targetField, invoiceDataï¼Œcountry code  â”‚               
â”‚  - Extract dependency data based on targetField              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 1: Historical Invoice Search               â”‚
â”‚  Path: ./context/invoices/{tenantId}/{countryCode}/          â”‚
â”‚  - SECURITY: Only search within tenant's directory!         â”‚
â”‚  - Find semantically similar invoices                        â”‚
â”‚  - If 90%+ confidence match found â†’ RETURN and STOP         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                  (No high-confidence match)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      STEP 2: Country-Specific Basic Data (TERMINAL)        â”‚
â”‚  Path: ./context/basic-data/codes/{codeType}/{country}.json  â”‚
â”‚  - Load all candidate values for the field type              â”‚
â”‚  - Semantic match against dependency data                    â”‚
â”‚  - ğŸš¨ IF file exists â†’ Select best match â†’ RETURN & STOP     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              (Country file exists â†’ IMMEDIATE RETURN & STOP)
                              â”‚
              (No country-specific data file exists)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 3: Global Basic Data                       â”‚
â”‚  Path: ./context/basic-data/global/*.json                    â”‚
â”‚        ./context/basic-data/codes/*/global.json              â”‚
â”‚  - Semantic match against dependency data                    â”‚
â”‚  - If found â†’ RETURN and STOP                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                  (No match in basic data)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STEP 4: WebSearch Fallback                      â”‚
â”‚  - Construct search query based on field type and context   â”‚
â”‚  - Use WebSearch tool to find standard codes/values          â”‚
â”‚  - Return with "source: websearch" indicator                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 1: Search Historical Invoices (Primary Source)

1. **Locate invoice directory**: `./context/invoices/{tenant_id}/{country_code}/`
   - **SECURITY CHECK**: Ensure path is within tenant scope!
   - Files are named: `{InvoiceDate}+{InvoiceNumber}.json`
   - Format: UBL 2.1 compliant JSON (single-line, no formatting)

2. **Search for similar invoices** using semantic understanding:
   - **å…³é”®**: å¿…é¡»è¯„ä¼°**ä¸Šä¸‹æ–‡ç›¸ä¼¼æ€§**ï¼ˆä¾å­—æ®µç±»å‹è€Œå®šï¼‰ï¼š
     - å•†å“çº§å­—æ®µï¼ˆunitCodeã€ç¨ç‡ç­‰ï¼‰ï¼šæ¯”è¾ƒå•†å“åç§°/æè¿°çš„è¯­ä¹‰ç›¸ä¼¼åº¦
     - å‘ç¥¨çº§å­—æ®µï¼ˆPaymentMeansç­‰ï¼‰ï¼šæ¯”è¾ƒäº¤æ˜“åœºæ™¯ã€ä¸šåŠ¡ç±»å‹çš„ç›¸ä¼¼åº¦
   - **ä¸è¦**ä»…å› ç§Ÿæˆ·/å›½å®¶åŒ¹é…å°±ä½¿ç”¨å†å²æ•°æ®
   - **å¦‚æœ**å†å²å‘ç¥¨ä¸­æ²¡æœ‰è¯­ä¹‰ç›¸ä¼¼çš„ä¸Šä¸‹æ–‡ï¼Œåˆ™**è·³è¿‡Step1ï¼Œç›´æ¥è¿›å…¥Step2**

3. **Extract field values** from semantically similar invoices:
   - Common field paths:
     - `InvoiceLine[].Item.ClassifiedTaxCategory.ID` â†’ Tax category code
     - `InvoiceLine[].InvoicedQuantity.unitCode` â†’ Unit of measure
     - `InvoiceLine[].Item.ClassifiedTaxCategory.Percent` â†’ Tax rate
     - `TaxTotal.TaxSubtotal[].TaxCategory.ID` â†’ Tax category at invoice level
     - `PaymentMeans.PaymentMeansCode.value` â†’ Payment method
   
4. **Return recommendations** if found:
   - **ä»…å½“**æ‰¾åˆ°è¯­ä¹‰ç›¸ä¼¼ä¸”ç½®ä¿¡åº¦90%+çš„å€¼æ—¶ï¼Œè¿”å›Step1æ¨èå¹¶ç»“æŸæŸ¥æ‰¾
   - **å¦åˆ™**è¿›å…¥Step2

### Step 2: Country-Specific Basic Data (MANDATORY TERMINAL STEP)

ğŸš¨ **CRITICAL TERMINATION RULE** ğŸš¨
- Step 2 is a TERMINAL step - execution MUST STOP here
- IF country-specific file exists â†’ Select best match â†’ IMMEDIATELY RETURN AND STOP
- UNDER NO CIRCUMSTANCES proceed to Step 3 after successful Step 2 completion
- Step 3 ONLY executes when country file DOES NOT exist

**ã€MANDATORY TERMINATIONã€‘å¦‚æœå›½å®¶ç‰¹å®šåŸºç¡€æ•°æ®æ–‡ä»¶å­˜åœ¨ï¼š**
1. å¿…é¡»ä»ä¸­é€‰æ‹©ä¸€ä¸ªæ¨èå€¼
2. å¿…é¡»ç«‹å³è¿”å›ç»“æœç»™ç”¨æˆ·
3. å¿…é¡»åœæ­¢æ‰€æœ‰åç»­å¤„ç†æ­¥éª¤
4. ç¦æ­¢ç»§ç»­æ‰§è¡ŒStep 3æˆ–ä»»ä½•å…¶ä»–æ­¥éª¤

1. **è¯»å–å¯¹åº”å­—æ®µçš„å›½å®¶ç‰¹å®šæ•°æ®**:

| Target Field | Data File Path |
|--------------|----------------|
| `unitCode` | `./context/basic-data/codes/uom-codes/{country}.json` |
| `TaxCategory` | `./context/basic-data/codes/tax-category-codes/{country}.json` |
| `PaymentMeans` | `./context/basic-data/codes/payment-means/{country}.json` |
| `AllowanceChargeReason` | `./context/basic-data/codes/allowance-reason-codes/{country}.json` |
| `ChargeCode` | `./context/basic-data/codes/charge-codes/{country}.json` |
| `DutyTaxFeeCategory` | `./context/basic-data/codes/duty-tax-fee-category-codes/{country}.json` |
| `TaxExemptionReason` | `./context/basic-data/codes/tax-exemption-reason-codes/{country}.json` |

2. **åŸºäºæŸ¥è¯¢ä¸Šä¸‹æ–‡è¿›è¡Œè¯­ä¹‰åŒ¹é…**:
   - **æ ¸å¿ƒåŸåˆ™**: ä»**æ‰€æœ‰å¯ç”¨çš„å€™é€‰å€¼**ä¸­è¯„ä¼°å“ªä¸ªæœ€é€‚åˆæŸ¥è¯¢ä¸Šä¸‹æ–‡
   - **ä¸¥æ ¼ç¦æ­¢**: æœç´¢é¢„è®¾çš„ç‰¹å®šå€¼
   - **æ­£ç¡®åšæ³•**: åˆ†æä¸Šä¸‹æ–‡ç‰¹å¾ â†’ éå†å€™é€‰å€¼ â†’ è¯„ä¼°åŒ¹é…åº¦ â†’ è¿”å›æœ€ä½³åŒ¹é…

3. **ğŸš¨ IMMEDIATE RETURN AND STOP**: ä»å›½å®¶ç‰¹å®šæ•°æ®ä¸­é€‰æ‹©æœ€ä½³åŒ¹é… â†’ **ç«‹å³è¿”å›ç»™ç”¨æˆ·** â†’ **åœæ­¢æ‰€æœ‰åç»­æ­¥éª¤**

## Step Completion Validation Checkpoints

### Post-Step 2 Validation - MANDATORY SELF-CHECK

Before proceeding beyond Step 2, you MUST answer these questions:

âœ… **Step 2 Completion Review:**
- Did I successfully find and read a country-specific data file? (Y/N)
- If YES: Did I identify and select the best matching value? (Y/N)
- If YES: Did I immediately return this result to the user? (Y/N)

ğŸš¨ **CRITICAL DECISION POINT:**
- If YES to all three questions: **STOP EXECUTION IMMEDIATELY**
- If NO country file found: **Proceed to Step 3**

âš ï¸ **WARNING:** Continuing to Step 3 after successful Step 2 completion violates the skill's core logic and user expectations.

### Step 3: Global Basic Data

**ä»…å½“å›½å®¶ç‰¹å®šæ•°æ®æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ‰§è¡Œ**

1. **è¯»å–globalå€™é€‰å€¼**:
   - `./context/basic-data/global/currencies.json` - Currency codes
   - `./context/basic-data/global/invoice-types.json` - Invoice type codes
   - `./context/basic-data/codes/*/global.json` - Various code enums

2. **ä½¿ç”¨ç›¸åŒçš„è¯­ä¹‰åŒ¹é…ç­–ç•¥**

3. **è¿”å›æœ€ä½³åŒ¹é…ç»“æœ**

### Step 4: WebSearch Fallback

**ä»…å½“Step 2å’ŒStep 3éƒ½æ— æ³•æä¾›æ¨èæ—¶æ‰§è¡Œ**

1. **æ„å»ºæœç´¢æŸ¥è¯¢**:

| Field Type | Search Query Template | Example |
|------------|----------------------|---------|
| `unitCode` | `"UN/ECE Rec 20 unit code for {productType} {country}"` | `"UN/ECE Rec 20 unit code for drone electronics MY"` |
| `TaxCategory` | `"{country} {taxType} tax category code for {productCategory}"` | `"MY SST tax category code for electronics"` |
| `PaymentMeans` | `"payment means code {country} {transactionType}"` | `"payment means code MY B2B bank transfer"` |
| `PostalZone` | `"{cityName} {country} postal code zip code"` | `"Kuala Lumpur MY postal code"` |
| `CountrySubentity` | `"{cityName} {country} state province region"` | `"Penang MY state"` |

2. **ä½¿ç”¨WebSearchå·¥å…·æœç´¢**

3. **è¿”å›å¸¦æœ‰sourceæ ‡è®°çš„æ¨è**:
   ```json
   {
     "recommended": "extracted_value",
     "reason": "Based on web search for {country} standards",
     "source": "websearch",
     "confidence": "medium"
   }
   ```

## Non-Negotiable Execution Rules

### Rule #1: Step 2 Termination is Absolute
- Step 2 is NOT a "search phase" - it's a "decision and return phase"
- "RETURN" means "RETURN TO USER" not "return value to next step"
- Finding country-specific data = Step 2 success = Execution end

### Rule #2: Decision Tree, Not Sequential Search
- âŒ WRONG: Try Step 1 â†’ Try Step 2 â†’ Try Step 3 â†’ Try Step 4
- âœ… CORRECT: If Step 1 succeeds â†’ STOP; else if Step 2 succeeds â†’ STOP; else...

### Rule #3: Self-Correction Mandate
- If you catch yourself starting Step 3 after successful Step 2:
  1. STOP IMMEDIATELY
  2. Return the Step 2 result instead
  3. This indicates a critical logic interpretation error

## Common Mistakes to Avoid

**âŒ é”™è¯¯1: æœç´¢é¢„è®¾çš„ç‰¹å®šå€¼ï¼Œè€Œéè¯­ä¹‰åŒ¹é…**

```python
# âŒ é”™è¯¯ç¤ºä¾‹
if 'EA' in my_uom_codes:  # é¢„è®¾ç­”æ¡ˆæ˜¯EA
    return 'EA'

# âœ… æ­£ç¡®åšæ³•
candidates = []
for code in country_specific_codes:
    confidence = evaluate_semantic_match(code, query_context)
    if confidence >= 90:
        candidates.append((code, confidence))
return best_match(candidates)
```

**âŒ é”™è¯¯2: å¿½ç•¥ä¸Šä¸‹æ–‡ç›¸ä¼¼æ€§ï¼Œç›´æ¥ä½¿ç”¨å†å²æ•°æ®**

```python
# âŒ é”™è¯¯: å†å²å‘ç¥¨éƒ½ç”¨EA â†’ æ¨èEAï¼ˆä½†æ²¡æ£€æŸ¥å•†å“æ˜¯å¦ç›¸ä¼¼ï¼‰

# âœ… æ­£ç¡®åšæ³•
if has_semantically_similar_items_in_history(query_product):
    return extract_field_from_similar_items()
else:
    skip_step1_go_to_step2()
```

**âŒ é”™è¯¯3: è·¨ç§Ÿæˆ·è®¿é—®æ•°æ®**

```python
# âŒ ä¸¥é‡å®‰å…¨é”™è¯¯
search_path = f"./context/invoices/{other_tenant_id}/{country}/"

# âœ… æ­£ç¡®åšæ³•
search_path = f"./context/invoices/{current_tenant_id}/{country}/"
validate_path_within_tenant_scope(search_path, current_tenant_id)
```

## Expected Behavior Examples

### Example 1: Country File Exists (Correct Behavior)
**Input:** tenantId="1", targetField="unitCode", country="MY"
**Expected Execution:**
1. Step 1: Historical search â†’ No high-confidence match
2. Step 2: MY.json found â†’ Load candidates â†’ Select "H87" â†’ **IMMEDIATE RETURN**
âœ… **CORRECT:** Return `{"recommended": "H87", "source": "country_basic_data"}` and STOP
âŒ **WRONG:** Continue to Step 3 Global search

### Example 2: Country File Missing (Correct Behavior)
**Input:** tenantId="1", targetField="unitCode", country="XX" (non-existent)
**Expected Execution:**
1. Step 1: Historical search â†’ No high-confidence match
2. Step 2: XX.json not found â†’ Skip to Step 3
3. Step 3: Global search â†’ Find candidates â†’ Return result
âœ… **CORRECT:** Continue to Step 3 only when country file missing

### Example 3: Self-Correction Scenario
**Situation:** You catch yourself starting Step 3 after successful Step 2
**Correct Response:**
1. STOP IMMEDIATELY
2. Return the Step 2 result instead
3. This indicates a critical logic interpretation error

## Output Format

### Success Response Format

```json
[
  {
    "recommended": "H87",
    "reason": "Found in historical invoice for similar product 'DJI Mavic 3 Drone' in tenant 1/MY. Unit code H87 (Piece) is commonly used for individual electronic devices.",
    "source": "historical",
    "confidence": "high"
  },
  {
    "recommended": "C62",
    "reason": "From MY country-specific uom-codes. C62 (One/Unit) is suitable for countable items like cameras and drones.",
    "source": "country_basic_data",
    "confidence": "high"
  }
]
```

### Response Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `recommended` | String | Yes | The recommended field value |
| `reason` | String | Yes | Explanation for the recommendation |
| `source` | Enum | Yes | `historical`, `country_basic_data`, `global_basic_data`, `websearch` |
| `confidence` | Enum | No | `high` (90%+), `medium` (70-89%), `low` (<70%) |

### Warning Response (When product info is limited)

```json
{
  "recommendations": [...],
  "warning": "Limited product information in invoiceData. Provide Item.Name and Item.Description for better results."
}
```

## Resources

This skill does not include bundled scripts, references, or assets. All data is located in the user's `/context` directory.

### Data Directory Structure

```
./context/
â”œâ”€â”€ pending-invoices/            # Pending invoices to process (TENANT-ISOLATED!)
â”‚   â””â”€â”€ {tenant_id}/
â”‚       â””â”€â”€ {invoice_filename}.xml|.json
â”‚
â”œâ”€â”€ invoices/                    # Historical invoices (TENANT-ISOLATED!)
â”‚   â””â”€â”€ {tenant_id}/
â”‚       â””â”€â”€ {country_code}/
â”‚           â””â”€â”€ {date}+{invoice_number}.json
â”‚
â””â”€â”€ basic-data/                  # Shared basic data (NO tenant isolation)
    â”œâ”€â”€ global/
    â”‚   â”œâ”€â”€ currencies.json
    â”‚   â””â”€â”€ invoice-types.json
    â””â”€â”€ codes/
        â”œâ”€â”€ uom-codes/{country}.json
        â”œâ”€â”€ tax-category-codes/{country}.json
        â”œâ”€â”€ payment-means/{country}.json
        â””â”€â”€ ...
```
